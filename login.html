<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Log in — ProfPilot</title>
  <meta name="description" content="Log in to your ProfPilot account to access your career simulators and continue your professional journey." />
  
  <!-- Favicons -->
  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon_32.png">
  <link rel="manifest" href="site.webmanifest">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics-compat.js"></script>

  <!-- FirebaseUI -->
  <link rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.css"/>
  <script src="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.js"></script>
  
  <!-- Custom Firebase Configuration -->
  <script src="firebase-init.js"></script>
  
  <style>
    html, body {
      font-family: Inter, system-ui, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    
    .header {
      background: white;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid #e2e8f0;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
    }
    
    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 4rem;
    }
    
    .logo-section-header {
      display: flex;
      align-items: center;
    }
    
    .logo-header {
      height: 2rem;
      width: auto;
      margin-right: 0.75rem;
    }
    
    .brand-name-header {
      font-size: 1.25rem;
      font-weight: 700;
      color: #1e40af;
    }
    
    .nav-links {
      display: flex;
      gap: 1.5rem;
    }
    
    .nav-link {
      color: #64748b;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    
    .nav-link:hover {
      color: #1e293b;
    }
    
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6rem 20px 20px;
    }
    
    .login-card {
      background: white;
      border-radius: 24px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
      padding: 48px;
      width: 100%;
      max-width: 480px;
      border: 1px solid rgba(226, 232, 240, 0.8);
      backdrop-filter: blur(20px);
    }
    
    .logo-section {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .logo {
      width: 64px;
      height: 64px;
      border-radius: 16px;
      margin: 0 auto 16px;
      display: block;
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .brand-name {
      font-size: 28px;
      font-weight: 800;
      color: #1e40af;
      margin: 0;
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .tagline {
      color: #64748b;
      font-size: 16px;
      margin: 8px 0 0 0;
      font-weight: 500;
    }
    
    .login-title {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
      margin: 0 0 8px 0;
    }
    
    .login-subtitle {
      color: #64748b;
      font-size: 16px;
      margin: 0 0 32px 0;
    }
    
    .back-link {
      display: inline-block;
      margin-top: 24px;
      color: #64748b;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    
    .back-link:hover {
      color: #1e40af;
    }
    
    .loader {
      text-align: center;
      padding: 20px;
      color: #64748b;
    }
    
    .spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      margin: 0 auto 12px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    #firebaseui-auth-container {
      margin-bottom: 24px;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo-section-header">
        <img src="logo.png" alt="ProfPilot" class="logo-header">
        <span class="brand-name-header">ProfPilot</span>
      </div>
      
      <nav class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
        <a href="dashboard.html" class="nav-link">Dashboard</a>
      </nav>
    </div>
  </header>
  
  <div class="login-container">
    <div class="login-card">
      <!-- Logo and Brand -->
      <div class="logo-section">
        <img src="logo.png" alt="ProfPilot logo" class="logo" />
        <h1 class="brand-name">ProfPilot</h1>
        <p class="tagline">Try a job in 3 days</p>
      </div>
      
      <!-- Login Form -->
      <h2 class="login-title">Welcome back</h2>
      <p class="login-subtitle">Sign in to continue your career exploration</p>
      
      <div id="firebaseui-auth-container"></div>
      <div id="loader" class="loader">
        <div class="spinner"></div>
        Loading authentication...
      </div>
      
      <!-- Back to Home -->
      <a href="index.html" class="back-link">
        ← Back to home
      </a>
    </div>
  </div>

  <script>
    // Wait for Firebase to be initialized
    document.addEventListener('DOMContentLoaded', function() {
      // Check if Firebase is initialized
      if (typeof firebase === 'undefined') {
        console.error('Firebase not loaded');
        document.getElementById('loader').innerHTML = `
          <div style="color: #dc2626; padding: 16px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca;">
            <strong>Error:</strong> Firebase failed to load. Please refresh the page.
          </div>
        `;
        return;
      }

      try {
        // Initialize FirebaseUI
        const ui = new firebaseui.auth.AuthUI(firebase.auth());
        
        // Configure FirebaseUI
        const uiConfig = {
          signInOptions: [
            firebase.auth.EmailAuthProvider.PROVIDER_ID,
            firebase.auth.GoogleAuthProvider.PROVIDER_ID
          ],
          signInFlow: 'popup',
          callbacks: {
            signInSuccessWithAuthResult: function(authResult, redirectUrl) {
              // User successfully signed in
              console.log('Sign in successful:', authResult.user.email);
              
              // Save user data to Firestore
              saveUserData({
                email: authResult.user.email,
                displayName: authResult.user.displayName || authResult.user.email,
                photoURL: authResult.user.photoURL,
                lastSignIn: firebase.firestore.FieldValue.serverTimestamp(),
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
              });
              
              // Track sign in
              trackUserAction('user_sign_in', {
                method: authResult.additionalUserInfo?.providerId || 'email'
              });
              
              // Redirect to dashboard
              window.location.href = 'dashboard.html';
              return false;
            },
            signInFailure: function(error) {
              console.error('Sign in failed:', error);
              showNotification(handleFirebaseError(error), 'error');
            }
          }
        };
        
        // Start FirebaseUI
        ui.start('#firebaseui-auth-container', uiConfig);

        // Auth state change listener
        firebase.auth().onAuthStateChanged((user) => {
          if (user) {
            // User is signed in
            document.getElementById('loader').style.display = 'none';
            console.log('User is signed in:', user.email);
          } else {
            // User is signed out
            document.getElementById('loader').style.display = 'block';
          }
        }, (error) => {
          console.error('Authentication error:', error);
          document.getElementById('loader').innerHTML = `
            <div style="color: #dc2626; padding: 16px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca;">
              <strong>Authentication Error:</strong> ${error.message}
            </div>
          `;
        });

      } catch (error) {
        console.error('Error initializing FirebaseUI:', error);
        document.getElementById('loader').innerHTML = `
          <div style="color: #dc2626; padding: 16px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca;">
            <strong>Initialization Error:</strong> ${error.message}
          </div>
        `;
      }
    });

    // Helper functions (these should be defined in firebase-init.js)
    function saveUserData(userData) {
      if (typeof firebase !== 'undefined' && firebase.firestore) {
        firebase.firestore().collection('users').doc(userData.email).set(userData, { merge: true })
          .then(() => console.log('User data saved'))
          .catch(error => console.error('Error saving user data:', error));
      }
    }

    function trackUserAction(action, data) {
      if (typeof firebase !== 'undefined' && firebase.analytics) {
        firebase.analytics().logEvent(action, data);
      }
    }

    function handleFirebaseError(error) {
      switch (error.code) {
        case 'auth/user-not-found':
          return 'No account found with this email address.';
        case 'auth/wrong-password':
          return 'Incorrect password.';
        case 'auth/invalid-email':
          return 'Invalid email address.';
        case 'auth/too-many-requests':
          return 'Too many failed attempts. Please try again later.';
        default:
          return 'An error occurred during sign in. Please try again.';
      }
    }

    function showNotification(message, type) {
      // Simple notification display
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px;
        border-radius: 8px;
        color: white;
        background: ${type === 'error' ? '#dc2626' : '#059669'};
        z-index: 1000;
        max-width: 300px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 5000);
    }
  </script>
</body>
</html>
