<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Stability Test - ProfPilot</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen">
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
      <h1 class="text-2xl font-bold text-slate-900 mb-6">üß™ Firebase Stability Test</h1>
      
      <div class="mb-6">
        <h2 class="text-lg font-semibold text-slate-900 mb-3">–¢–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ Firebase:</h2>
        
        <div class="space-y-4">
          <button id="run-stability-test" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
            üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
          </button>
          
          <button id="clear-cache" class="bg-yellow-600 text-white py-2 px-4 rounded-lg hover:bg-yellow-700 transition-colors">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
          </button>
          
          <button id="test-simple" class="bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
            ‚úÖ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
          </button>
        </div>
      </div>
      
      <div id="results" class="space-y-2">
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ -->
      </div>
      
      <div class="mt-6 p-4 bg-slate-100 rounded-lg">
        <h3 class="font-semibold text-slate-900 mb-2">–°—Ç–∞—Ç—É—Å:</h3>
        <div id="status" class="text-slate-600">
          –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    const resultsDiv = document.getElementById('results');
    const statusDiv = document.getElementById('status');
    
    function addResult(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `p-3 rounded-lg ${
        type === 'success' ? 'bg-green-50 text-green-700 border border-green-200' :
        type === 'error' ? 'bg-red-50 text-red-700 border border-red-200' :
        type === 'warning' ? 'bg-yellow-50 text-yellow-700 border border-yellow-200' :
        'bg-blue-50 text-blue-700 border border-blue-200'
      }`;
      div.textContent = message;
      resultsDiv.appendChild(div);
    }
    
    // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
    document.getElementById('test-simple').addEventListener('click', async function() {
      addResult('üß™ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç Firebase...', 'info');
      
      try {
        if (typeof firebase === 'undefined') {
          addResult('‚ùå Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
          return;
        }
        
        const db = firebase.firestore();
        const snapshot = await db.collection('purchases').limit(1).get();
        addResult('‚úÖ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ', 'success');
        
      } catch (error) {
        addResult(`‚ùå –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –Ω–µ –ø—Ä–æ—à–µ–ª: ${error.message}`, 'error');
      }
    });
    
    // –¢–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
    document.getElementById('run-stability-test').addEventListener('click', async function() {
      addResult('üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏...', 'info');
      
      let successCount = 0;
      let errorCount = 0;
      const totalTests = 10;
      
      for (let i = 1; i <= totalTests; i++) {
        try {
          const db = firebase.firestore();
          await db.collection('purchases').limit(1).get();
          addResult(`‚úÖ –¢–µ—Å—Ç ${i}/${totalTests} –ø—Ä–æ—à–µ–ª`, 'success');
          successCount++;
        } catch (error) {
          addResult(`‚ùå –¢–µ—Å—Ç ${i}/${totalTests} –Ω–µ –ø—Ä–æ—à–µ–ª: ${error.message}`, 'error');
          errorCount++;
        }
        
        // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
        await new Promise(resolve => setTimeout(resolve, 500));
      }
      
      const successRate = (successCount / totalTests) * 100;
      addResult(`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${successCount}/${totalTests} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ (${successRate.toFixed(1)}%)`, 'info');
      
      if (successRate >= 90) {
        statusDiv.innerHTML = '‚úÖ <strong>Firebase —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ!</strong><br>–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.';
      } else if (successRate >= 50) {
        statusDiv.innerHTML = '‚ö†Ô∏è <strong>Firebase —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ.</strong><br>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∏ –ø–µ—Ä–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞.';
      } else {
        statusDiv.innerHTML = '‚ùå <strong>Firebase –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.</strong><br>–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ Firebase Console.';
      }
    });
    
    // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
    document.getElementById('clear-cache').addEventListener('click', function() {
      addResult('üóëÔ∏è –û—á–∏—â–∞–µ–º –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞...', 'info');
      addResult('‚ÑπÔ∏è –ù–∞–∂–º–∏—Ç–µ Ctrl+Shift+R (–∏–ª–∏ Cmd+Shift+R –Ω–∞ Mac) –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'warning');
      addResult('‚ÑπÔ∏è –ò–ª–∏ –∑–∞–∫—Ä–æ–π—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∑–∞–Ω–æ–≤–æ', 'info');
      
      // –ü–æ–ø—ã—Ç–∫–∞ –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => {
            caches.delete(name);
          });
          addResult('‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ', 'success');
        });
      }
    });
  </script>
</body>
</html>
