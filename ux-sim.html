<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ProfPilot — UX Designer Simulator</title>
  <meta name="description" content="3-day UX Designer simulator with guided feedback." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand: { 50:'#eff6ff',100:'#dbeafe',200:'#bfdbfe',300:'#93c5fd',400:'#60a5fa',500:'#3b82f6',600:'#2563eb',700:'#1d4ed8',800:'#1e40af',900:'#1e3a8a' } },
          boxShadow: { soft: '0 10px 30px rgba(2, 6, 23, 0.08)' }
        }
      }
    }
  </script>
  <style>html,body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}</style>
</head>
<body class="bg-slate-50 text-slate-900">

  <!-- Navbar (как на главной) -->
  <header class="fixed top-0 w-full z-20 backdrop-blur border-b border-slate-200 bg-white/80 transition-all shadow-sm">
    <div class="mx-auto max-w-6xl flex items-center justify-between px-4 sm:px-6 lg:px-8 h-16">
      <a href="/" class="flex items-center gap-2 text-xl font-bold text-brand-700">
        <img src="logo.png" alt="ProfPilot logo" class="h-8 w-8 rounded-xl object-contain" />
        ProfPilot
      </a>
      <nav class="hidden md:flex items-center gap-8 text-slate-700 font-medium">
        <a href="/#roles" class="hover:text-brand-700 transition">Simulators</a>
        <a href="/#about" class="hover:text-brand-700 transition">About</a>
        <a href="/#pricing" class="hover:text-brand-700 transition">Pricing</a>
        <a href="/#faq" class="hover:text-brand-700 transition">FAQ</a>
      </nav>
      <div class="hidden sm:flex items-center gap-2">
        <a href="/checkout?role=ux-designer" class="rounded-xl bg-brand-600 text-white px-5 py-2 font-semibold shadow-soft hover:bg-brand-700 transition">Start now</a>
        <a href="/login.html" class="px-4 py-2 border border-sky-600 text-sky-700 font-semibold rounded-xl hover:bg-sky-50 transition">Log in</a>
      </div>
    </div>
  </header>
  <div class="h-16"></div>

  <!-- Hero -->
  <section class="py-10 bg-gradient-to-b from-white via-white to-slate-100 border-b border-slate-200">
    <div class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
      <a href="/ux.html" class="text-sm text-slate-500 hover:underline">← Back to overview</a>
      <h1 class="mt-2 text-3xl sm:text-4xl font-extrabold tracking-tight">UX Designer — 3‑Day Simulator</h1>
      <p class="mt-3 text-slate-700 max-w-3xl">Answer each step. You’ll get instant AI feedback and tips. Your progress saves automatically.</p>
      <div id="userBadge" class="mt-4 text-sm text-slate-500"></div>
    </div>
  </section>

  <!-- Days / Steps -->
  <main class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-10 space-y-10">

    <!-- Day 1 -->
    <section class="bg-white border border-slate-200 rounded-2xl shadow-soft">
      <div class="p-6 border-b border-slate-200">
        <h2 class="text-2xl font-bold">Day 1 — Diagnose the drop‑off</h2>
        <p class="mt-2 text-slate-600">Users drop off on the onboarding field “About me / Summary”. Form 2–3 hypotheses why.</p>
      </div>

      <!-- Step d1s1 -->
      <div class="p-6 space-y-3">
        <h3 class="font-semibold">Step d1s1 · Hypotheses</h3>
        <p class="text-sm text-slate-600">Write 2–3 realistic reasons for abandonment, referencing hints (e.g., wall of text, unclear expectations, no examples).</p>

        <textarea id="d1s1" class="w-full rounded-lg border border-slate-300 p-3 focus:outline-none focus:ring-2 focus:ring-brand-600" rows="6" placeholder="Your hypotheses…"></textarea>

        <div class="flex items-center gap-3">
          <button class="rounded-xl bg-brand-600 text-white px-4 py-2 font-semibold hover:bg-brand-700 transition"
                  onclick="submitStep('ux-designer',1,'d1s1')"
                  id="btn-d1s1">Get feedback</button>
          <span id="loader-d1s1" class="hidden text-sm text-slate-500">Thinking…</span>
        </div>

        <div id="out-d1s1" class="hidden mt-4 rounded-lg border border-slate-200 bg-slate-50 p-4"></div>
      </div>
    </section>

    <!-- Day 2 -->
    <section class="bg-white border border-slate-200 rounded-2xl shadow-soft">
      <div class="p-6 border-b border-slate-200">
        <h2 class="text-2xl font-bold">Day 2 — Propose practical fixes</h2>
        <p class="mt-2 text-slate-600">Suggest 2–3 low‑effort UX changes (microcopy, progress, examples, placeholders) to reduce friction.</p>
      </div>

      <!-- Step d2s1 -->
      <div class="p-6 space-y-3">
        <h3 class="font-semibold">Step d2s1 · Quick fixes</h3>
        <textarea id="d2s1" class="w-full rounded-lg border border-slate-300 p-3 focus:outline-none focus:ring-2 focus:ring-brand-600" rows="6" placeholder="Your proposed fixes…"></textarea>

        <div class="flex items-center gap-3">
          <button class="rounded-xl bg-brand-600 text-white px-4 py-2 font-semibold hover:bg-brand-700 transition"
                  onclick="submitStep('ux-designer',2,'d2s1')"
                  id="btn-d2s1">Get feedback</button>
          <span id="loader-d2s1" class="hidden text-sm text-slate-500">Thinking…</span>
        </div>

        <div id="out-d2s1" class="hidden mt-4 rounded-lg border border-slate-200 bg-slate-50 p-4"></div>
      </div>
    </section>

    <!-- Day 3 -->
    <section class="bg-white border border-slate-200 rounded-2xl shadow-soft">
      <div class="p-6 border-b border-slate-200">
        <h2 class="text-2xl font-bold">Day 3 — Present the idea</h2>
        <p class="mt-2 text-slate-600">Outline a 1–2 screen sketch and a short rationale for the team. Keep it pragmatic.</p>
      </div>

      <!-- Step d3s1 -->
      <div class="p-6 space-y-3">
        <h3 class="font-semibold">Step d3s1 · Pitch</h3>
        <textarea id="d3s1" class="w-full rounded-lg border border-slate-300 p-3 focus:outline-none focus:ring-2 focus:ring-brand-600" rows="6" placeholder="How you’ll present…"></textarea>

        <div class="flex items-center gap-3">
          <button class="rounded-xl bg-brand-600 text-white px-4 py-2 font-semibold hover:bg-brand-700 transition"
                  onclick="submitStep('ux-designer',3,'d3s1')"
                  id="btn-d3s1">Get feedback</button>
          <span id="loader-d3s1" class="hidden text-sm text-slate-500">Thinking…</span>
        </div>

        <div id="out-d3s1" class="hidden mt-4 rounded-lg border border-slate-200 bg-slate-50 p-4"></div>
      </div>
    </section>

  </main>

  <!-- Footer (как на главной) -->
  <footer class="py-10 border-t border-slate-200 bg-white">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 text-sm text-slate-600">
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
        <div class="flex items-center gap-2">
          <img src="logo.png" alt="ProfPilot logo" class="h-8 w-8 rounded-xl object-contain" />
          <span>ProfPilot</span>
        </div>
        <div class="flex flex-wrap items-center gap-4">
          <a href="/policy.html" class="hover:underline">Privacy Policy</a>
          <a href="/terms.html" class="hover:underline">Terms</a>
          <span class="text-slate-400">© <span id="year"></span> ProfPilot</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <!-- Твой общий init (из прошлого шага) -->
  <script src="/firebase-init.js"></script>

  <script>
    // --- Настройка ---
    // URL твоей серверной функции: см. deploy из шага с Functions
    // Пример: https://us-central1-YOUR_PROJECT_ID.cloudfunctions.net/aiRespond
    const API_URL = 'https://us-central1-YOUR_PROJECT_ID.cloudfunctions.net/aiRespond';

    // Рубрики (можно потом грузить из Firestore /scenarios)
    const RUBRICS = {
      'd1s1': `Evaluate on: logic (30), reference to signals/data (30), realism (20), clarity (20). Penalize hand-waving or overclaims.`,
      'd2s1': `Evaluate on: expected UX impact (40), implementation effort (20), risks & side effects (20), measurability (20).`,
      'd3s1': `Evaluate on: structure (30), clarity/conciseness (30), value for team (30), risks/next steps (10).`
    };

    // Проверка логина и бейдж
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.replace('/login.html');
        return;
      }
      const email = user.email ? user.email.replace(/(.{2}).+(@.+)/,'$1***$2') : 'signed in';
      document.getElementById('userBadge').textContent = `Signed in · ${email}`;
      document.getElementById('year').textContent = new Date().getFullYear();
    });

    async function submitStep(role, day, stepId) {
      const user = auth.currentUser;
      if (!user) { window.location.href = '/login.html'; return; }

      // элементы
      const input = document.getElementById(stepId);
      const btn = document.getElementById('btn-' + stepId);
      const out = document.getElementById('out-' + stepId);
      const loader = document.getElementById('loader-' + stepId);

      const userAnswer = (input.value || '').trim();
      if (!userAnswer) { input.focus(); return; }

      // UI state
      btn.disabled = true;
      loader.classList.remove('hidden');

      try {
        const idToken = await user.getIdToken();
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${idToken}`
          },
          body: JSON.stringify({
            role, day, stepId,
            userAnswer,
            rubric: RUBRICS[stepId] || ''
          })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Server error');

        // Показать фидбек
        out.classList.remove('hidden');
        out.innerHTML = `
          <div class="text-sm text-slate-500 mb-2">AI feedback · score: <b>${data.score ?? 0}</b></div>
          <div class="text-slate-800 text-sm leading-6 whitespace-pre-wrap">${(data.aiFeedback || '').trim
