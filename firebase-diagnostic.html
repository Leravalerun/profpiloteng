<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Diagnostic Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4">
        <h1 class="text-3xl font-bold text-slate-900 mb-8 text-center">üî• Firebase Diagnostic Tool</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Configuration Check -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">üìã Configuration Check</h2>
                <div id="config-status" class="space-y-2">
                    <div class="flex items-center gap-2">
                        <div id="firebase-sdk" class="w-4 h-4 rounded-full bg-gray-300"></div>
                        <span>Firebase SDK</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div id="firebase-config" class="w-4 h-4 rounded-full bg-gray-300"></div>
                        <span>Firebase Config</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div id="firebase-init" class="w-4 h-4 rounded-full bg-gray-300"></div>
                        <span>Firebase Initialization</span>
                    </div>
                </div>
            </div>

            <!-- Connection Test -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">üîó Connection Test</h2>
                <div id="connection-status" class="space-y-2">
                    <div class="flex items-center gap-2">
                        <div id="firestore-connection" class="w-4 h-4 rounded-full bg-gray-300"></div>
                        <span>Firestore Connection</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div id="firestore-read" class="w-4 h-4 rounded-full bg-gray-300"></div>
                        <span>Firestore Read</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div id="firestore-write" class="w-4 h-4 rounded-full bg-gray-300"></div>
                        <span>Firestore Write</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Results -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-semibold text-slate-900 mb-4">üìä Detailed Results</h2>
            <div id="detailed-results" class="space-y-4">
                <p class="text-slate-600">Running diagnostics...</p>
            </div>
        </div>

        <!-- Actions -->
        <div class="mt-8 text-center">
            <button id="run-diagnostics" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                üîÑ Run Full Diagnostics
            </button>
        </div>

        <!-- Configuration Display -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-semibold text-slate-900 mb-4">‚öôÔ∏è Current Configuration</h2>
            <pre id="config-display" class="bg-slate-100 p-4 rounded-lg text-sm overflow-x-auto"></pre>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        let diagnostics = {
            firebaseSDK: false,
            firebaseConfig: false,
            firebaseInit: false,
            firestoreConnection: false,
            firestoreRead: false,
            firestoreWrite: false
        };

        function updateStatus(elementId, status) {
            const element = document.getElementById(elementId);
            const colors = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'pending': 'bg-gray-300'
            };
            element.className = `w-4 h-4 rounded-full ${colors[status]}`;
        }

        function addResult(message, type = 'info') {
            const results = document.getElementById('detailed-results');
            const colors = {
                'success': 'text-green-700 bg-green-50',
                'error': 'text-red-700 bg-red-50',
                'warning': 'text-yellow-700 bg-yellow-50',
                'info': 'text-blue-700 bg-blue-50'
            };
            
            const div = document.createElement('div');
            div.className = `p-3 rounded-lg ${colors[type]}`;
            div.textContent = message;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('detailed-results').innerHTML = '';
        }

        async function runDiagnostics() {
            clearResults();
            addResult('üîç Starting Firebase diagnostics...', 'info');
            
            // Reset all status indicators
            Object.keys(diagnostics).forEach(key => {
                updateStatus(key.replace(/([A-Z])/g, '-$1').toLowerCase(), 'pending');
            });

            // Test 1: Firebase SDK
            addResult('Testing Firebase SDK...', 'info');
            
            // Wait a bit for scripts to load
            await new Promise(resolve => setTimeout(resolve, 500));
            
            if (typeof firebase !== 'undefined') {
                diagnostics.firebaseSDK = true;
                updateStatus('firebase-sdk', 'success');
                addResult('‚úÖ Firebase SDK loaded successfully', 'success');
            } else {
                updateStatus('firebase-sdk', 'error');
                addResult('‚ùå Firebase SDK not loaded', 'error');
                addResult('üí° Check if Firebase scripts are properly included', 'warning');
                return;
            }

            // Test 2: Firebase Config
            addResult('Testing Firebase configuration...', 'info');
            
            // Wait for config to load
            let configLoaded = false;
            for (let i = 0; i < 10; i++) {
                if (window.firebaseConfig) {
                    configLoaded = true;
                    break;
                }
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            if (configLoaded) {
                diagnostics.firebaseConfig = true;
                updateStatus('firebase-config', 'success');
                addResult('‚úÖ Firebase configuration found', 'success');
                
                // Display configuration
                document.getElementById('config-display').textContent = JSON.stringify(window.firebaseConfig, null, 2);
            } else {
                updateStatus('firebase-config', 'error');
                addResult('‚ùå Firebase configuration not found', 'error');
                addResult('üí° Check if firebase-config.js is properly loaded', 'warning');
                return;
            }

            // Test 3: Firebase Initialization
            addResult('Testing Firebase initialization...', 'info');
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ª–∏ Firebase —É–∂–µ
                if (firebase.apps.length === 0) {
                    firebase.initializeApp(window.firebaseConfig);
                    addResult('‚úÖ Firebase initialized successfully', 'success');
                } else {
                    addResult('‚úÖ Firebase already initialized', 'success');
                }
                diagnostics.firebaseInit = true;
                updateStatus('firebase-init', 'success');
            } catch (error) {
                updateStatus('firebase-init', 'error');
                addResult(`‚ùå Firebase initialization failed: ${error.message}`, 'error');
                return;
            }

            // Test 4: Firestore Connection
            addResult('Testing Firestore connection...', 'info');
            try {
                const db = firebase.firestore();
                diagnostics.firestoreConnection = true;
                updateStatus('firestore-connection', 'success');
                addResult('‚úÖ Firestore connection established', 'success');
            } catch (error) {
                updateStatus('firestore-connection', 'error');
                addResult(`‚ùå Firestore connection failed: ${error.message}`, 'error');
                return;
            }

            // Test 5: Firestore Read
            addResult('Testing Firestore read permissions...', 'info');
            try {
                const db = firebase.firestore();
                await db.collection('test').limit(1).get();
                diagnostics.firestoreRead = true;
                updateStatus('firestore-read', 'success');
                addResult('‚úÖ Firestore read test successful', 'success');
            } catch (error) {
                updateStatus('firestore-read', 'error');
                addResult(`‚ùå Firestore read test failed: ${error.message}`, 'error');
                
                if (error.message.includes('Missing or insufficient permissions')) {
                    addResult('üí° Solution: Update Firestore rules in Firebase Console', 'warning');
                }
            }

            // Test 6: Firestore Write
            addResult('Testing Firestore write permissions...', 'info');
            try {
                const db = firebase.firestore();
                const testData = {
                    message: 'Diagnostic test',
                    timestamp: new Date().toISOString()
                };
                await db.collection('test').add(testData);
                diagnostics.firestoreWrite = true;
                updateStatus('firestore-write', 'success');
                addResult('‚úÖ Firestore write test successful', 'success');
            } catch (error) {
                updateStatus('firestore-write', 'error');
                addResult(`‚ùå Firestore write test failed: ${error.message}`, 'error');
                
                if (error.message.includes('Missing or insufficient permissions')) {
                    addResult('üí° Solution: Update Firestore rules in Firebase Console', 'warning');
                }
            }

            // Summary
            const passedTests = Object.values(diagnostics).filter(Boolean).length;
            const totalTests = Object.keys(diagnostics).length;
            
            if (passedTests === totalTests) {
                addResult(`üéâ All tests passed! (${passedTests}/${totalTests})`, 'success');
            } else {
                addResult(`‚ö†Ô∏è Some tests failed (${passedTests}/${totalTests})`, 'warning');
            }
        }

        // Run diagnostics on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runDiagnostics, 1000);
        });

        // Manual run button
        document.getElementById('run-diagnostics').addEventListener('click', runDiagnostics);
    </script>
</body>
</html>
