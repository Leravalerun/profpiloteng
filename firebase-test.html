<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Firebase Test — ProfPilot</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-8">
  
  <div class="max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">Firebase Test</h1>
    
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Status</h2>
      <div id="status" class="text-sm space-y-2">
        <div>Loading...</div>
      </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-4">Test Firebase</h2>
      <button id="test-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" disabled>
        Test Firebase Connection
      </button>
      <div id="result" class="mt-4 text-sm"></div>
    </div>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="firebase-init.js"></script>

  <script>
    const statusDiv = document.getElementById('status');
    const testBtn = document.getElementById('test-btn');
    const resultDiv = document.getElementById('result');
    
    function addStatus(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `p-2 rounded text-sm ${
        type === 'error' ? 'bg-red-100 text-red-700' :
        type === 'success' ? 'bg-green-100 text-green-700' :
        type === 'warning' ? 'bg-yellow-100 text-yellow-700' :
        'bg-blue-100 text-blue-700'
      }`;
      div.textContent = message;
      statusDiv.appendChild(div);
    }
    
    // Check Firebase status every second
    let checkCount = 0;
    const maxChecks = 30;
    
    function checkFirebaseStatus() {
      checkCount++;
      
      addStatus(`Check ${checkCount}: Checking Firebase status...`);
      
      if (typeof firebase !== 'undefined') {
        addStatus('✅ Firebase SDK loaded', 'success');
        
        if (firebase.apps && firebase.apps.length > 0) {
          addStatus('✅ Firebase app initialized', 'success');
          
          if (window.auth && window.db) {
            addStatus('✅ Firebase services available', 'success');
            testBtn.disabled = false;
            addStatus('🎉 Firebase is ready!', 'success');
            return;
          } else {
            addStatus('⚠️ Firebase app initialized but services not available', 'warning');
          }
        } else {
          addStatus('⚠️ Firebase SDK loaded but app not initialized', 'warning');
        }
      } else {
        addStatus('❌ Firebase SDK not loaded', 'error');
      }
      
      if (checkCount < maxChecks) {
        setTimeout(checkFirebaseStatus, 1000);
      } else {
        addStatus('❌ Firebase failed to initialize after 30 seconds', 'error');
      }
    }
    
    // Start checking
    setTimeout(checkFirebaseStatus, 1000);
    
    // Test button
    testBtn.addEventListener('click', async () => {
      try {
        resultDiv.innerHTML = '<div class="text-blue-600">Testing Firebase connection...</div>';
        
        // Test auth
        const auth = firebase.auth();
        resultDiv.innerHTML += '<div class="text-green-600">✅ Auth service working</div>';
        
        // Test firestore
        const db = firebase.firestore();
        resultDiv.innerHTML += '<div class="text-green-600">✅ Firestore service working</div>';
        
        // Test configuration
        const config = getFirebaseConfig();
        resultDiv.innerHTML += `<div class="text-green-600">✅ Config loaded: ${config.projectId}</div>`;
        
        resultDiv.innerHTML += '<div class="text-green-600 font-semibold">🎉 All Firebase services working correctly!</div>';
        
      } catch (error) {
        resultDiv.innerHTML = `<div class="text-red-600">❌ Error: ${error.message}</div>`;
      }
    });
  </script>
</body>
</html>