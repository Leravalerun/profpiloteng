<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test - Simple</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center">
    <div class="max-w-md w-full bg-white rounded-2xl shadow-lg p-8">
        <h1 class="text-2xl font-bold text-slate-900 mb-6 text-center">🔥 Firebase Test</h1>
        
        <div id="status" class="mb-6 p-4 rounded-lg">
            <p class="text-center">Testing Firebase connection...</p>
        </div>
        
        <div class="space-y-4">
            <button id="testConnection" class="w-full bg-blue-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                Test Firebase Connection
            </button>
            
            <button id="testWrite" class="w-full bg-green-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-green-700 transition-colors">
                Test Write to Firestore
            </button>
            
            <button id="testRead" class="w-full bg-purple-600 text-white py-3 px-6 rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                Test Read from Firestore
            </button>
        </div>
        
        <div id="results" class="mt-6 p-4 bg-slate-100 rounded-lg hidden">
            <h3 class="font-semibold mb-2">Results:</h3>
            <pre id="output" class="text-sm text-slate-700 whitespace-pre-wrap"></pre>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        let db = null;
        let isConnected = false;

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            const colors = {
                'info': 'bg-blue-100 text-blue-800',
                'success': 'bg-green-100 text-green-800',
                'error': 'bg-red-100 text-red-800',
                'warning': 'bg-yellow-100 text-yellow-800'
            };
            
            status.className = `mb-6 p-4 rounded-lg ${colors[type]}`;
            status.innerHTML = `<p class="text-center">${message}</p>`;
        }

        function showResults(data) {
            const results = document.getElementById('results');
            const output = document.getElementById('output');
            
            results.classList.remove('hidden');
            output.textContent = JSON.stringify(data, null, 2);
        }

        // Test Firebase connection
        document.getElementById('testConnection').addEventListener('click', async function() {
            try {
                updateStatus('Testing Firebase connection...', 'info');
                
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK not loaded');
                }
                
                if (!window.firebaseConfig) {
                    throw new Error('Firebase config not loaded');
                }
                
                // Initialize Firebase
                firebase.initializeApp(window.firebaseConfig);
                db = firebase.firestore();
                
                // Test connection
                await db.collection('test').limit(1).get();
                
                isConnected = true;
                updateStatus('✅ Firebase connected successfully!', 'success');
                showResults({ status: 'connected', timestamp: new Date().toISOString() });
                
            } catch (error) {
                let errorMessage = error.message;
                
                // Provide helpful error messages
                if (error.message.includes('Missing or insufficient permissions')) {
                    errorMessage = '❌ Firestore rules are too restrictive. Please update rules in Firebase Console.';
                } else if (error.message.includes('Firebase SDK not loaded')) {
                    errorMessage = '❌ Firebase SDK failed to load. Check internet connection.';
                } else if (error.message.includes('Firebase config not loaded')) {
                    errorMessage = '❌ Firebase config not found. Check firebase-config.js file.';
                }
                
                updateStatus(errorMessage, 'error');
                showResults({ 
                    error: error.message, 
                    code: error.code,
                    suggestion: error.message.includes('Missing or insufficient permissions') 
                        ? 'Go to Firebase Console → Firestore → Rules and update rules to allow all operations for testing'
                        : 'Check browser console for more details'
                });
            }
        });

        // Test write to Firestore
        document.getElementById('testWrite').addEventListener('click', async function() {
            if (!isConnected) {
                updateStatus('⚠️ Please test connection first', 'warning');
                return;
            }
            
            try {
                updateStatus('Testing write to Firestore...', 'info');
                
                const testData = {
                    message: 'Hello from test page!',
                    timestamp: new Date().toISOString(),
                    random: Math.random()
                };
                
                const docRef = await db.collection('test').add(testData);
                
                updateStatus('✅ Write test successful!', 'success');
                showResults({ 
                    success: true, 
                    docId: docRef.id, 
                    data: testData 
                });
                
            } catch (error) {
                updateStatus(`❌ Write test failed: ${error.message}`, 'error');
                showResults({ error: error.message, code: error.code });
            }
        });

        // Test read from Firestore
        document.getElementById('testRead').addEventListener('click', async function() {
            if (!isConnected) {
                updateStatus('⚠️ Please test connection first', 'warning');
                return;
            }
            
            try {
                updateStatus('Testing read from Firestore...', 'info');
                
                const snapshot = await db.collection('test').limit(5).get();
                const docs = [];
                
                snapshot.forEach(doc => {
                    docs.push({
                        id: doc.id,
                        data: doc.data()
                    });
                });
                
                updateStatus('✅ Read test successful!', 'success');
                showResults({ 
                    success: true, 
                    count: docs.length,
                    docs: docs 
                });
                
            } catch (error) {
                updateStatus(`❌ Read test failed: ${error.message}`, 'error');
                showResults({ error: error.message, code: error.code });
            }
        });

        // Auto-test on load
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('testConnection').click();
            }, 1000);
        });
    </script>
</body>
</html>
